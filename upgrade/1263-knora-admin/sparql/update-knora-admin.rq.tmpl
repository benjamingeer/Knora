@prefix : <http://www.knora.org/ontology/knora-admin#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix knora-base: <http://www.knora.org/ontology/knora-base#> .
@prefix luc: <http://www.ontotext.com/owlim/lucene#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix salsah-gui: <http://www.knora.org/ontology/salsah-gui#> .
@prefix standoff: <http://www.knora.org/ontology/standoff#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .

# Delete knora-base.
DELETE {
    GRAPH <http://www.knora.org/ontology/knora-base> {
        ?oldKnoraBaseS ?oldKnoraBaseP ?oldKnoraBaseO .
    }
} ;

# Insert knora-admin.
INSERT DATA {
    GRAPH <http://www.knora.org/ontology/knora-admin> {
        $knoraAdmin
    }
} ;

# Insert knora-base.
INSERT DATA {
    GRAPH <http://www.knora.org/ontology/knora-base> {
        $knoraBase
    }
} ;

$updatePredicates ;

$updateObjects ;

# Update permission strings.
DELETE {
    GRAPH ?g {
        ?s knora-base:hasPermissions ?oldPermissions .
    }
} INSERT {
    GRAPH ?g {
        ?s knora-base:hasPermissions ?newPermissions .
    }
}
USING <http://www.ontotext.com/explicit>
WHERE
{
    GRAPH ?g {
        ?s knora-base:hasPermissions ?oldPermissions .
    }

    FILTER(REGEX(?oldPermissions, "knora-base"))
    BIND(REPLACE(?oldPermissions, "knora-base", "knora-admin") AS ?newPermissions)
}
