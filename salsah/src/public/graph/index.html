<!DOCTYPE>

<html>

  <head>
    <title>Graph data demo</title>

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <script src="ramda.min.js"></script>
    
    <script src="cytoscape.min.js"></script>
    <script src="cola.min.js"></script>
    <script src="cytoscape-cola.js"></script>

    <style>
      body {
        font-family: sans-serif;
        font-size: 12px;
      }

      #cy {
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: 999;
      }
    </style>

    <script>
      "use strict";

      function knoraNode2Cytoscape(knoraNode) {
        return {
          data: {
            id: knoraNode.resourceIri,
            label: knoraNode.resourceLabel
          },
          classes: 'node'
        };
      }

      function knoraEdge2Cytoscape(knoraEdge) {
        return {
          data: {
            source: knoraEdge.source,
            target: knoraEdge.target,
            label: knoraEdge.propertyLabel
          },
          classes: 'edge'
        };
      }

      function knoraData2Cytoscape(dataFromKnora) {
        var cytoscapeNodes = R.map(knoraNode2Cytoscape, dataFromKnora.nodes);
        var cytoscapeEdges = R.map(knoraEdge2Cytoscape, dataFromKnora.edges);
        return cytoscapeNodes.concat(cytoscapeEdges);
      }


      document.addEventListener('DOMContentLoaded', function() {

        // Data from http://localhost:3333/v1/graphdata/http%3A%2F%2Fdata.knora.org%2Fanything%2Fstart?depth=4
        var dataFromKnora = {
          "nodes": [
            {
              "resourceIri": "http:\/\/data.knora.org\/sHCLAGg-R5qJ6oPZPV-zOQ",
              "resourceLabel": "Golf",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/7uuGcnFcQJq08dMOralyCQ",
              "resourceLabel": "Hotel",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/5IEswyQFQp2bxXDrOyEfEA",
              "resourceLabel": "Delta",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/iqW_PBiHRdyTFzik8tuSog",
              "resourceLabel": "Quebec",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/L5xU7Qe5QUu6Wz3cDaCxbA",
              "resourceLabel": "Papa",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/cmfk1DMHRBiR4-_6HXpEFA",
              "resourceLabel": "Mike",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/A67ka6UQRHWf313tbhQBjw",
              "resourceLabel": "Victor",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/tPfZeNMvRVujCQqbIbvO0A",
              "resourceLabel": "Echo",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/Lz7WEqJETJqqsUZQYexBQg",
              "resourceLabel": "Foxtrot",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/anything\/start",
              "resourceLabel": "Romeo",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/0C-0L1kORryKzJAJxxRyRQ",
              "resourceLabel": "Sierra",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            },
            {
              "resourceIri": "http:\/\/data.knora.org\/WLSHxQUgTOmG1T0lBU2r5w",
              "resourceLabel": "Tango",
              "resourceClassIri": "http:\/\/www.knora.org\/ontology\/anything#Thing",
              "resourceClassLabel": "Thing"
            }
          ],
          "edges": [
            {
              "source": "http:\/\/data.knora.org\/anything\/start",
              "target": "http:\/\/data.knora.org\/0C-0L1kORryKzJAJxxRyRQ",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/tPfZeNMvRVujCQqbIbvO0A",
              "target": "http:\/\/data.knora.org\/Lz7WEqJETJqqsUZQYexBQg",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/anything\/start",
              "target": "http:\/\/data.knora.org\/WLSHxQUgTOmG1T0lBU2r5w",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/Lz7WEqJETJqqsUZQYexBQg",
              "target": "http:\/\/data.knora.org\/sHCLAGg-R5qJ6oPZPV-zOQ",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/anything\/start",
              "target": "http:\/\/data.knora.org\/tPfZeNMvRVujCQqbIbvO0A",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/L5xU7Qe5QUu6Wz3cDaCxbA",
              "target": "http:\/\/data.knora.org\/iqW_PBiHRdyTFzik8tuSog",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/5IEswyQFQp2bxXDrOyEfEA",
              "target": "http:\/\/data.knora.org\/cmfk1DMHRBiR4-_6HXpEFA",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/WLSHxQUgTOmG1T0lBU2r5w",
              "target": "http:\/\/data.knora.org\/A67ka6UQRHWf313tbhQBjw",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/cmfk1DMHRBiR4-_6HXpEFA",
              "target": "http:\/\/data.knora.org\/L5xU7Qe5QUu6Wz3cDaCxbA",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/iqW_PBiHRdyTFzik8tuSog",
              "target": "http:\/\/data.knora.org\/anything\/start",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            },
            {
              "source": "http:\/\/data.knora.org\/sHCLAGg-R5qJ6oPZPV-zOQ",
              "target": "http:\/\/data.knora.org\/7uuGcnFcQJq08dMOralyCQ",
              "propertyIri": "http:\/\/www.knora.org\/ontology\/anything#hasOtherThing",
              "propertyLabel": "Another thing"
            }
          ],
          "userdata": {
            "email": null,
            "username": null,
            "firstname": null,
            "projects_info": [
              
            ],
            "user_id": null,
            "lastname": null,
            "token": null,
            "active_project": null,
            "projects": null,
            "lang": "en",
            "password": null
          },
          "status": 0
        };

        var elements = knoraData2Cytoscape(dataFromKnora);

        var cy = window.cy = cytoscape({
          container: document.getElementById('cy'),

          boxSelectionEnabled: false,
          autounselectify: true,

          layout: {
            name: 'cola',
            infinite: true,
            fit: true
          },

          style: [
            {
              selector: 'node',
              style: {
                'label': 'data(label)',
                'shape': 'rectangle',
                'width': 'label',
                'height': 'label',
                'text-valign': 'center',
                'text-halign': 'center',
                'background-color': '#ffffff',
                'border-width': 1,
                'border-style': 'solid',
                'border-color': '#9dbaea',
                'font-size': 10
              }
            },

            {
              selector: 'edge',
              style: {
                'label': 'data(label)',
                'width': 1,
                'target-arrow-shape': 'triangle-backcurve',
                'line-color': '#9dbaea',
                'target-arrow-color': '#9dbaea',
                'curve-style': 'bezier',
                'text-opacity': 0.75,
                'edge-text-rotation': 'autorotate',
                'font-size': 8
              }
            },
          ],

          elements: elements
        });

        cy.on('click', 'node', function(event){
          alert("You clicked on node " + event.cyTarget.data("id") + ", which has label " + event.cyTarget.data("label"));
        });

      });
    </script>
  </head>

  <body>

    <div id="cy"></div>

  </body>

</html>
